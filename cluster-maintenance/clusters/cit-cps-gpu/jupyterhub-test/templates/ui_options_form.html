<!-- Profile Selector UI (layered, boxed) -->
<style>
  .hub-ui * { box-sizing: border-box; }
  .hub-ui { max-width: 980px; margin: 24px auto; padding: 0 8px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; }
  .ui-title { font-size: 20px; font-weight: 600; color: #1f2937; margin-bottom: 6px; }
  .subtle { color: #6b7280; font-size: 13px; margin-bottom: 12px; }
  .layer { background: #fff; border: 1px solid #e5e7eb; border-radius: 14px; box-shadow: 0 1px 1px rgba(0,0,0,.03), 0 8px 20px rgba(17,24,39,.06); padding: 18px; margin-bottom: 16px; }
  .grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; } @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }
  .card { position: relative; border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px; transition: box-shadow .15s ease, border-color .15s ease, transform .05s ease; background: linear-gradient(180deg, rgba(249,250,251,.6), rgba(255,255,255,1)); }
  .card:hover { box-shadow: 0 8px 22px rgba(17,24,39,.08); border-color:#d1d5db; transform: translateY(-1px); }
  .card input[type="radio"] { position: absolute; inset:0; opacity:0; cursor:pointer; }
  .card.selected { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.15); }
  .row { display:flex; align-items:center; justify-content:space-between; gap: 10px; }
  .name { font-weight: 600; color:#111827; }
  .meta { display:flex; gap:8px; flex-wrap: wrap; }
  .chip { font-size:12px; border:1px solid #e5e7eb; padding:3px 8px; border-radius:999px; color:#374151; background:#f9fafb; }
  .gpu-chip { border-color:#c7d2fe; background:#eef2ff; color:#4338ca; }
  .cpu-chip { border-color:#bae6fd; background:#e0f2fe; color:#075985; }
  .ram-chip { border-color:#c7f9cc; background:#e8fce9; color:#166534; }
  .notice { display:none; border:1px dashed #f59e0b; background: linear-gradient(180deg, #fff7ed, #fff); color:#92400e; border-radius:12px; padding:12px; margin-bottom: 12px; }
  .hint { font-size:12px; color:#6b7280; margin-top: 4px; }
  .input, .select { width:100%; padding:10px 12px; border:1.5px solid #e5e7eb; border-radius:10px; background:white; }
  .select-inline { width:auto; min-width: 160px; }
</style>

<div class="hub-ui">
  <div class="ui-title">Select a Profile</div>
  <div class="subtle">For longer CLI workloads, use <code>tmux</code> in a Terminal (we'll install it for you).</div>

  <div id="gpu-access-notice" class="notice">
    <strong>No GPU access.</strong> Choose the CPU profile or contact admins for <code>cpsHPCAccess</code>.
  </div>

  <div class="layer">
    <div class="grid" id="profile-grid">
      <label class="card selected" data-slug="cpu-default">
        <input type="radio" name="profile" value="cpu-default" checked>
        <div class="row">
          <div class="name">CPU (Default)</div>
          <div class="meta"><span class="chip cpu-chip">2 vCPU (shared)</span><span class="chip ram-chip">2 GiB</span></div>
        </div>
      </label>

      <label class="card" data-slug="gpu-pytorch-single" id="card-gpu-pt-1">
        <input type="radio" name="profile" value="gpu-pytorch-single">
        <div class="row"><div class="name">GPU: PyTorch (1×)</div>
          <div class="meta"><span class="chip gpu-chip">1× GPU</span><span class="chip cpu-chip">16 vCPU</span><span class="chip ram-chip">64 GiB</span></div>
        </div>
      </label>

      <label class="card" data-slug="gpu-tensorflow-single" id="card-gpu-tf-1">
        <input type="radio" name="profile" value="gpu-tensorflow-single">
        <div class="row"><div class="name">GPU: TensorFlow (1×)</div>
          <div class="meta"><span class="chip gpu-chip">1× GPU</span><span class="chip cpu-chip">16 vCPU</span><span class="chip ram-chip">64 GiB</span></div>
        </div>
      </label>

      <label class="card" data-slug="gpu-pytorch-dual" id="card-gpu-pt-2">
        <input type="radio" name="profile" value="gpu-pytorch-dual">
        <div class="row"><div class="name">GPU: PyTorch (2×)</div>
          <div class="meta"><span class="chip gpu-chip">2× GPU</span><span class="chip cpu-chip">32 vCPU</span><span class="chip ram-chip">128 GiB</span></div>
        </div>
      </label>

      <label class="card" data-slug="gpu-tensorflow-dual" id="card-gpu-tf-2">
        <input type="radio" name="profile" value="gpu-tensorflow-dual">
        <div class="row"><div class="name">GPU: TensorFlow (2×)</div>
          <div class="meta"><span class="chip gpu-chip">2× GPU</span><span class="chip cpu-chip">32 vCPU</span><span class="chip ram-chip">128 GiB</span></div>
        </div>
      </label>

      <!-- MIG: only 1g.5gb available -->
      <label class="card" data-slug="gpu-mig-1g5" id="card-gpu-mig-1g5">
        <input type="radio" name="profile" value="gpu-mig-1g5">
        <div class="row"><div class="name">GPU: MIG 1g.5gb</div>
          <div class="meta"><span class="chip gpu-chip">1× MIG 1g.5gb</span><span class="chip cpu-chip">8 vCPU</span><span class="chip ram-chip">32 GiB</span></div>
        </div>
      </label>
    </div>
  </div>

  <div class="layer">
    <div class="row" style="align-items:flex-start; gap:16px; flex-wrap: wrap;">
      <div style="flex:1; min-width: 260px;">
        <div class="name" style="margin-bottom:6px;">Optional: Custom Image</div>
        <input class="input" type="text" id="custom-image" name="custom_image" placeholder="registry/repo:tag (admins only)" />
        <div class="hint">Overrides the profile image.</div>
      </div>
      <div class="select-inline">
        <div class="name" style="margin-bottom:6px;">GPUs</div>
        <select class="select" id="custom-gpus" name="custom_gpus">
          <option value="0" selected>0 × GPU</option>
          <option value="1">1 × GPU</option>
          <option value="2">2 × GPU</option>
        </select>
        <div class="hint">Requires GPU access.</div>
      </div>
    </div>
  </div>

  <div class="hint">Reminder: for long CLI jobs, start a Terminal and use <code>tmux</code> (we'll install it automatically).</div>
</div>

<script>
(function(){
  var cards = document.querySelectorAll('.card');
  function selectCard(el){ cards.forEach(c=>c.classList.remove('selected')); el.classList.add('selected'); var i = el.querySelector('input[type="radio"]'); if (i) i.checked = true; }
  cards.forEach(c=>c.addEventListener('click', ()=>selectCard(c)));

  var allowedGPUGroups = ['cpsHPCAccess','jupyter_admin'];
  function getCookie(name){ return document.cookie.split('; ').reduce(function(val,c){ var p=c.split('='); return p[0]===name?decodeURIComponent(p.slice(1).join('=')):val; }, null); }
  var xsrf = getCookie('_xsrf');
  fetch('/hub/api/user', {
    credentials: 'same-origin',
    headers: Object.assign({'Accept':'application/json'}, xsrf ? {'X-XSRFToken': xsrf} : {})
  })
  .then(r=>{ if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); })
  .then(user=>{
    var groups = Array.isArray(user.groups) ? user.groups.map(g=> typeof g==='string'? g : (g&&g.name)? g.name : '') : [];
    var isAdmin = !!user.admin;
    var hasGPU = isAdmin || groups.some(g=> allowedGPUGroups.indexOf(g)!==-1);
    if (!hasGPU) {
      ['card-gpu-pt-1','card-gpu-tf-1','card-gpu-pt-2','card-gpu-tf-2','card-gpu-mig-1g5'].forEach(id=>{
        var el=document.getElementById(id); if(el){ el.style.opacity=.5; var inp=el.querySelector('input[type="radio"]'); if(inp) inp.disabled=true; }
      });
      var cg=document.getElementById('custom-gpus'); if(cg){ cg.value='0'; Array.from(cg.options).forEach(o=>{ if(o.value!=='0') o.disabled=true; }); }
      var notice=document.getElementById('gpu-access-notice'); if(notice) notice.style.display='block';
    }
  })
  .catch(()=>{});
})();
</script>
