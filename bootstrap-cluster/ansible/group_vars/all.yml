---
# K3s Configuration
k3s_version: v1.31.2+k3s1
k3s_token: "{{ lookup('password', '/dev/null chars=ascii_letters,digits length=32') }}"

# Cluster settings
cluster_cidr: "10.42.0.0/16"
service_cidr: "10.43.0.0/16"
cluster_dns: "10.43.0.10"
cluster_domain: "cluster.local"

# K3s API VIP (optional - for kube-vip)
api_vip: "10.0.0.100"

# Control plane configuration
control_plane_taint: "node-role.kubernetes.io/control-plane=true:NoSchedule"

# Cluster network for NFS exports
cluster_subnet: "10.21.0.0/16"

# NFS Configuration
# When using k3s-storage node, this will be set dynamically
# Otherwise, configure your external NFS server here
nfs_server: "{{ hostvars[groups['storage'][0]]['ansible_host'] if 'storage' in groups and groups['storage']|length > 0 else '10.0.0.30' }}"
nfs_path: "/srv/nfs/k3s-storage"
nfs_storage_class_name: "nfs-client"
nfs_provisioner_namespace: "nfs-provisioner"

# Fast scratch storage
scratch_storage_class_name: "fast-scratch"
scratch_path: "/mnt/nvme/scratch"

# GPU Configuration
gpu_operator_version: "v25.10.0"
gpu_operator_namespace: "gpu-operator"
# K3s containerd socket (needed for NVIDIA toolkit to signal containerd)
k3s_containerd_socket: "/run/k3s/containerd/containerd.sock"

# Helm repositories
helm_repos:
  - name: nvidia
    url: https://nvidia.github.io/gpu-operator
  - name: nfs-subdir-external-provisioner
    url: https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner
  - name: rancher-stable
    url: https://releases.rancher.com/server-charts/stable
  - name: jetstack
    url: https://charts.jetstack.io
  - name: ingress-nginx
    url: https://kubernetes.github.io/ingress-nginx

# Rancher configuration
rancher_hostname: "rancher.cps.unileoben.ac.at"  # Assumption: set DNS to a control-plane IP
rancher_version: ""  # Leave empty to install the latest compatible Rancher chart for your Kubernetes version
rancher_replicas: 3
rancher_bootstrap_password: "admin"

# Deploy ingress-nginx (Traefik disabled in K3s install)
install_ingress_nginx: true

# OIDC (Authentik) for Rancher
rancher_oidc:
  client_id: "wdrQAHf26MmmSR3ZoEQJSUkT84wHMxhqEbRK9al3"
  client_secret: "l9NhqMvaTgGUPfCE7LMhkv5jW5R1aAJQsYDDxVZxKHfAzy3RFFr2ZtOxQ6lest7F7GyshZuaRoZrXpaGOPa2ZWFdJP6MVNPoeCZED3EkdAnAbCnW0T9WZ9SpGOntqp2S"
  issuer: "https://auth.cps.unileoben.ac.at/application/o/rancher/"
  auth_url: "https://auth.cps.unileoben.ac.at/application/o/authorize/"
  token_url: "https://auth.cps.unileoben.ac.at/application/o/token/"
  userinfo_url: "https://auth.cps.unileoben.ac.at/application/o/userinfo/"
  logout_url: "https://auth.cps.unileoben.ac.at/application/o/rancher/end-session/"
  jwks_url: "https://auth.cps.unileoben.ac.at/application/o/rancher/jwks/"
  scopes:
    - openid
    - profile
    - email
    - groups
  access_mode: "unrestricted"  # or 'restricted' with allowed principals

# System settings
disable_swap: true
enable_ipv4_forward: true

# Packages to install
common_packages:
  - curl
  - wget
  - git
  - vim
  - htop
  - net-tools
  - nfs-common

gpu_worker_packages:
  - pciutils
  - linux-headers-generic
